
cmake_minimum_required(VERSION 3.2)

project(goBind)
find_library(golang REQUIRED)

set(CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR}/cmake")
set(CMAKE_Go_COMPILER "/usr/local/go/bin/go")
set(CMAKE_Go_COMPILER_ENV_VAR "GO_COMPILER")

target_link_libraries(goBind PUBLIC BindingTest)

set(SOURCE_FILES
  num.go
  lib.go
  num_test.go
  )

add_custom_command(OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/${LIB}
  DEPENDS ${SRCS}
  WORKING_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}
  COMMAND env GOPATH=${GOPATH} go build -buildmode=c-archive
  -o "${CMAKE_CURRENT_BINARY_DIR}/${LIB}"
  ${CMAKE_GO_FLAGS} ./...
  COMMENT "Building Go library")
